(function(c){function l(a){var b=a.data(j);a.css({width:"100px",border:"0",outline:"0"}).wrap(c("<li>")).parent().wrap(c("<ul>").addClass("tags_list",b.showTagClass));a.parent().parent().click({cObj:a},function(a){a.data.cObj.focus()});var e=b.initTags;e&&a.multiTag("addTag",e);b.isCanDelete&&(c.browser.mozilla?a.keypress(g):a.keydown(g));c(".tags_list").find(".bt_close").live("click",{reObj:a},function(a){b.onRemoveBefore&&b.onRemoveBefore.apply(a.data.reObj);c(this).parent().remove();b.onRemoveAfter&&
b.onRemoveAfter.apply(a.data.reObj)})}function g(a){var b=c(a.target);!b.val()&&a.which==8&&b.parent().parent().find("li[class='tag_item']:last").remove()}function m(a,b){var e=a.data(j);e.onAddBefore&&e.onAddBefore.apply(a);var f=e.maxTagNum;if(b){var b=c.isArray(b)?b:b.split(),g=a.parent(),h;for(h in b){var d;if(!(d=!f||f<=0||!c(this).data("tagList")||c(this).data("tagList").length<f))if(d=!e.isCanRepeat){a:{var i=c(this);d=b;var i=i.data("tagList"),k=void 0;for(k in i)if(i[k]==d){d=true;break a}d=
false}d=!d}if(d)g.before(c("<li><span>"+b[h]+"</span><a class='bt_close' title='删除'>x</a></li>").addClass("tag_item")),d=c(this).data("tagList"),c.isArray(d)?d.push(b[h]):c(this).data("tagList",[b[h]]);else break}}e.onAddAfter&&e.onAddAfter.apply(a)}function n(){return c(this).data("tagList")}var j="options";c.fn.multiTag=function(){var a=arguments[0];if(arguments.length==0||typeof a=="object")a=c.extend({},c.fn.multiTag.defaults,a||{}),c(this).data(j,a),l(c(this));else if(a)switch(a){case "addTag":if(arguments.length>
1){for(var a=[],b=1,e=arguments.length;b<e;b++){var f=arguments[b];c.isArray(f)?a=a.concat(f):a.push(f)}m(this,a)}break;case "getValue":return n(this);case "destory":alert(this),this.unwrap().parent().find("ul").remove(),this.unwrap()}return this};c.fn.multiTag.defaults={isCanDelete:true,addTag:false,initTags:false,showTagClass:"",onAddBefore:false,onAddAfter:false,onRemoveBefore:false,onRemoveAfter:false,maxTagNum:false,isCanRepeat:false}})(jQuery);
