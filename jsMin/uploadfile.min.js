function UploadFile(a,b){this._form=this._iframe=null;this._file=a;this._options=b;this._upload();this._sending=false;this._time=1E3;this._timeoutFN=this._finish=null}UploadFile.bind=function(a,b){return function(){return a.apply(b,arguments)}};UploadFile.isIE=navigator.userAgent.indexOf("MSIE")>-1;UploadFile._counter=1;
UploadFile.prototype={_setIframe:function(){if(!this._iframe){var a="UploadFile_"+UploadFile._counter++,b=document.createElement(UploadFile.isIE?"<iframe name='"+a+"'/>":"iframe");b.name=a;b.style.display="none";this._finish=UploadFile.bind(function(){var a=eval("("+(this._iframe.contentWindow||this._iframe.contentDocument).document.body.innerHTML+")"),b=this._options.onFinish;this._sending=this._file.disabled=false;this._dispose();b&&b(a)},this);UploadFile.isIE?b.attachEvent("onload",this._finish):
b.onload=this._finish;this._iframe=b;document.body.appendChild(b)}},_setForm:function(){var a=document.createElement("form");a.target=this._iframe.name;a.method="post";a.encoding="multipart/form-data";a.action=this._options.action?this._options.action:"";a.style.padding=0;a.style.margin=0;a.style.border=0;a.backgroundColor="transparent";a.style.display="inline";var b=this._file;b.parentNode.insertBefore(a,b).appendChild(b);this._form=a},_dispose:function(){clearTimeout(this._timeoutFN);if(this._iframe){var a=
this._iframe;UploadFile.isIE?a.detachEvent("onload",this._finish):a.onload=null;document.body.removeChild(a);this._iframe=null}if(this._form){var a=this._form,b=a.parentNode;b&&(b.insertBefore(this._file,a),b.removeChild(a));this._form=null}},_upload:function(){this._dispose();var a=this._options.onReady;a&&a();this._setIframe();this._setForm();this._form.submit();this._sending=true;this._timeoutFN=setTimeout(function(){this._sending&&(alert("由于网络原因或文件太大上传超时！"),this._dispose())},this._time)}};
