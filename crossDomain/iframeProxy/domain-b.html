<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--[if lt ie 7]> <html class="ie ie6" lang="zh-CN"> <![endif]-->
<!--[if ie 7]>    <html class="ie ie7" lang="zh-CN"> <![endif]-->
<!--[if ie 8]>    <html class="ie ie8" lang="zh-CN"> <![endif]-->
<!--[if gt ie 8]><!-->  <html> <!--<![endif]-->
 <head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<!--[if lt ie 7]> <title>IE 7 以下版本</title> <![endif]-->
<!--[if ie 7]> <title>IE 7</title> <![endif]-->
<!--[if ie 8]> <title>IE 8</title> <![endif]-->
<!--[if gt ie 8]><title>IE 8 以上版本</title><![endif]-->
		<meta name="Generator" content="EditPlus"/>
		<meta name="Author" content=""/>
		<meta name="Keywords" content=""/>
		<meta name="Description" content=""/>
	</head>

	<body>
	<input type="text" value="test" id="test_text"/>
	<input type="button" value="send" onclick="send()"/>
	<textarea id="result" style="width:90%"></textarea>
	<script type="text/javascript">
	<!--
		function checkHash(){
			var oldHash = location.hash;
			setInterval(function(){
				var newHash = location.hash;
				if(oldHash != newHash){
					oldHash = newHash;
					document.getElementById('result').value = 'hash change domain-b:'+newHash;
					sendMessageToDomainA('receive '+newHash);
				}
			},200);
		}
		checkHash();
		function createFrame(){
			var iframe = document.createElement('iframe');
			document.body.appendChild(iframe);
			return iframe;
		}
		function getOtherDomain(){
			var domains = {
				'js.zk.com': 'js.tonny.com',
				'js.tonny.com': 'js.zk.com'
			}
			return 'http://'+domains[location.host];
		}
		function sendMessageToDomainA(message){
			var iframe = createFrame();
			var fn =  function(){
				iframe.parentNode.removeChild(iframe);
			}
			if (iframe.attachEvent){
				iframe.attachEvent("onload", fn);
			}else{
				iframe.onload = fn;
			}
			iframe.src = getOtherDomain()+'/crossDomain/iframeProxy/proxy-a.html#'+message;
		}
		function send(){
			sendMessageToDomainA( document.getElementById('test_text').value );
		}
	//-->
	</script>
	</body>
</html>
